<?php

namespace Tests\Unit\ModuleName;

{{use_namespace}}
use App\Modules\ModuleName\Dto\CreateServiceNameDto;
use App\Modules\ModuleName\Dto\SearchServiceNameDto;
use App\Modules\ModuleName\Dto\UpdateServiceNameDto;
use \App\Modules\Users\Models\Users;
use \App\Modules\ModuleName\Services\ServiceNameService;
use Tests\TestCase;

class ServiceNameTest extends TestCase
{

    public ServiceNameService $service;

    protected function setUp(): void
    {
        parent::setUp();

        $this->service = app(ServiceNameService::class);
    }

    /**
     * @testdox create - default
     */
    public function testCreateServiceName()
    {
        {{header_tests}}
        $ServiceNameData = ServiceName::factory()->raw();

        $resource = $this->service->create(CreateServiceNameDto::make($ServiceNameData), $userAdmin);

        $this->assertGreaterThanOrEqual(1, $resource['id']);
        $this->assertEqualsArrayLeft($ServiceNameData, $resource);
    }

    /**
     * @testdox update - default
     */
    public function testUpdateServiceName()
    {
        {{header_tests}}
        $ServiceNameData = ServiceName::factory()->raw();

        $resource = $this->service->create(CreateServiceNameDto::make($ServiceNameData), $userAdmin);

        $ServiceNameDataUpdate = ServiceName::factory()->raw();

        $resourceUpdated = $this->service->update($resource['id'], UpdateServiceNameDto::make($ServiceNameDataUpdate), $userAdmin);

        $this->assertEqualsArrayLeft($ServiceNameDataUpdate, $resourceUpdated);
    }

    /**
     * @testdox get - default
     */
    public function testGetServiceName()
    {
        {{header_tests}}
        $ServiceNameData = ServiceName::factory()->raw();

        $resourceCreated = $this->service->create(CreateServiceNameDto::make($ServiceNameData), $userAdmin);

        $resource = $this->service->get($resourceCreated['id'], $userAdmin);

        $this->assertGreaterThanOrEqual(1, $resource['id']);
        $this->assertEqualsArrayLeft($ServiceNameData, $resource);
    }

    /**
     * @testdox search - default
     */
    public function testSearchServiceName()
    {
        {{header_tests}}
        ServiceName::factory()->count(5)->create();

        $results = $this->service->search(SearchServiceNameDto::make([
            "filters" => [
                "id" => 1
            ]
        ]), $userAdmin);
        $this->assertEquals(1, $results['count']);

    }

    /**
     * @testdox delete - default
     */
    public function testDeleteServiceName()
    {
        {{header_tests}}
        $ServiceNameData = ServiceName::factory()->raw();

        $resource = $this->service->create(CreateServiceNameDto::make($ServiceNameData), $userAdmin);

        $this->service->delete($resource['id'], $userAdmin);

//        // If softDelete = false
//        $this->assertNull(ServiceName::query()->find($resource['id']));

        // If softDelete = true
        $this->assertFalse(!!ServiceName::query()->find($resource['id'])->enabled);
    }
}
